"use strict";(self.webpackChunkselectdb_portal=self.webpackChunkselectdb_portal||[]).push([[16417],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,h=p["".concat(s,".").concat(m)]||p[m]||c[m]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},41198:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));const o={title:"update",language:"en"},i=void 0,l={unversionedId:"administrator-guide/update",id:"version-0.15/administrator-guide/update",title:"update",description:"\x3c!--",source:"@site/versioned_docs/version-0.15/administrator-guide/update.md",sourceDirName:"administrator-guide",slug:"/administrator-guide/update",permalink:"/docs/0.15/administrator-guide/update",draft:!1,tags:[],version:"0.15",frontMatter:{title:"update",language:"en"},sidebar:"docs",previous:{title:"Variable",permalink:"/docs/0.15/administrator-guide/variables"},next:{title:"Multi-tenancy",permalink:"/docs/0.15/administrator-guide/multi-tenant"}},s={},u=[{value:"Applicable scenarios",id:"applicable-scenarios",level:2},{value:"Explanation of terms",id:"explanation-of-terms",level:2},{value:"Fundamentals",id:"fundamentals",level:2},{value:"Example",id:"example",level:3},{value:"Basic operations",id:"basic-operations",level:2},{value:"UPDATE syntax",id:"update-syntax",level:3},{value:"Synchronization",id:"synchronization",level:3},{value:"Performance",id:"performance",level:3},{value:"Concurrency Control",id:"concurrency-control",level:3},{value:"Risks of use",id:"risks-of-use",level:2},{value:"Version",id:"version",level:2}],d={toc:u};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"update"},"Update"),(0,r.kt)("p",null,"If we need to modify or update the data in Doris, we can use the UPDATE command."),(0,r.kt)("h2",{id:"applicable-scenarios"},"Applicable scenarios"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To modify the value of a row that meets certain conditions."),(0,r.kt)("li",{parentName:"ul"},"Point updates, small updates, where the rows to be updated are preferably a very small part of the entire table."),(0,r.kt)("li",{parentName:"ul"},"Only could be used in Unique table")),(0,r.kt)("h2",{id:"explanation-of-terms"},"Explanation of terms"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Unique model: A data model in the Doris system. When the user imports rows with the same Key, the Value of the latter overrides the existing Value, in the same sense as Unique in Mysql.")),(0,r.kt)("h2",{id:"fundamentals"},"Fundamentals"),(0,r.kt)("p",null,"Use the query engine's own where filtering logic to filter the rows that need to be updated from the table to be updated. Then use the Unique model's own Value column replacement logic to change the rows to be updated and reinsert them into the table. This enables row-level updates."),(0,r.kt)("h3",{id:"example"},"Example"),(0,r.kt)("p",null,"Suppose there is an order table in Doris, where order id is the Key column, order status, and order amount are the Value columns. The data state is as follows."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"order id"),(0,r.kt)("th",{parentName:"tr",align:null},"order amount"),(0,r.kt)("th",{parentName:"tr",align:null},"order status"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"100"),(0,r.kt)("td",{parentName:"tr",align:null},"Pending Payment")))),(0,r.kt)("p",null,"At this time, after the user clicks the payment, Doris system needs to change the order id to '1' order status to 'pending shipment', you need to use the Update function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"UPDATE order SET order status='To be shipped' WHERE order id=1;\n")),(0,r.kt)("p",null,"After the user executes the UPDATE command, the system performs the following three steps."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Step 1: Read the rows that satisfy WHERE order id=1\n(1, 100, 'pending payment')"),(0,r.kt)("li",{parentName:"ul"},"Step 2: Change the order status of the row from 'Pending Payment' to 'Pending Shipping'\n(1, 100, 'Pending shipment')"),(0,r.kt)("li",{parentName:"ul"},"Step 3: Insert the updated row back into the table to achieve the updated effect.\n| order id | order amount | order status |\n| ---| ---| ---|\n| 1 | 100| Pending Payment |\n| 1 | 100 | Pending shipments |\nSince the table order is a UNIQUE model, the rows with the same Key, after which the latter will take effect, so the final effect is as follows.\n| order id | order amount | order status |\n|--|--|--|\n| 1 | 100 | Pending shipments |")),(0,r.kt)("h2",{id:"basic-operations"},"Basic operations"),(0,r.kt)("h3",{id:"update-syntax"},"UPDATE syntax"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"UPDATE table_name SET value=xxx WHERE condition;")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"table_name"),": the table to be updated, must be a UNIQUE model table to update.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"value=xxx: The column to be updated, the left side of the equation must be the value column of the table. The right side of the equation can be a constant or an expression transformation of a column in a table.\nFor example, if value = 1, then the value of the column to be updated will be 1.\nFor example, if value = value + 1, the value of the column to be updated is incremented by 1.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"condition: Only rows that satisfy the condition will be updated. condition must be an expression that results in a Boolean type.\nFor example, if k1 = 1, only rows with a k1 column value of 1 will be updated.\nFor example, if k1 = k2, only rows with the same value in column k1 as in column k2 will be updated.\nNo support for unfilled condition, i.e., no support for full table updates."))),(0,r.kt)("h3",{id:"synchronization"},"Synchronization"),(0,r.kt)("p",null,"The Update syntax is a synchronization syntax in Doris. If the Update statement succeeds, the update succeeds and the data is visible."),(0,r.kt)("h3",{id:"performance"},"Performance"),(0,r.kt)("p",null,"The performance of the Update statement is closely related to the number of rows to be updated and the retrieval efficiency of the condition."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Number of rows to be updated: The more rows to be updated, the slower the Update statement will be. This is consistent with the principle of importing.\nDoris updates are more suitable for occasional update scenarios, such as changing the values of individual rows.\nDoris is not suitable for large batches of data changes. Large modifications can make Update statements take a long time to run.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Condition retrieval efficiency: Doris Update implements the principle of reading the rows that satisfy the condition first, so if the condition retrieval efficiency is high, the Update will be faster.\nThe condition column should ideally be hit, indexed, or bucket clipped. This way Doris does not need to scan the entire table and can quickly locate the rows that need to be updated. This improves update efficiency.\nIt is strongly discouraged to include the UNIQUE model value column in the condition column."))),(0,r.kt)("h3",{id:"concurrency-control"},"Concurrency Control"),(0,r.kt)("p",null,"By default, multiple concurrent Update operations on the same table are not allowed at the same time."),(0,r.kt)("p",null,"The main reason for this is that Doris currently supports row updates, which means that even if the user declares ",(0,r.kt)("inlineCode",{parentName:"p"},"SET v2 = 1"),", virtually all other Value columns will be overwritten (even though the values are not changed)."),(0,r.kt)("p",null,"This presents a problem in that if two Update operations update the same row at the same time, the behavior may be indeterminate. That is, there may be dirty data."),(0,r.kt)("p",null,"However, in practice, the concurrency limit can be turned on manually if the user himself can guarantee that even if concurrent updates are performed, they will not operate on the same row at the same time. This is done by modifying the FE configuration ",(0,r.kt)("inlineCode",{parentName:"p"},"enable_concurrent_update"),". When the configuration value is true, there is no limit on concurrent updates."),(0,r.kt)("h2",{id:"risks-of-use"},"Risks of use"),(0,r.kt)("p",null,"Since Doris currently supports row updates and uses a two-step read-and-write operation, there is uncertainty about the outcome of an Update statement if it modifies the same row as another Import or Delete statement."),(0,r.kt)("p",null,"Therefore, when using Doris, you must be careful to control the concurrency of Update statements and other DML statements on the ",(0,r.kt)("em",{parentName:"p"},"user side itself"),"."),(0,r.kt)("h2",{id:"version"},"Version"),(0,r.kt)("p",null,"Doris Version 0.15.x +"))}p.isMDXComponent=!0}}]);