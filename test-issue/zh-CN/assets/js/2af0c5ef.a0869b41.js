"use strict";(self.webpackChunkselectdb_portal=self.webpackChunkselectdb_portal||[]).push([[23137],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var r=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,l=function(e,n){if(null==e)return{};var t,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,l=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(t),m=l,g=u["".concat(s,".").concat(m)]||u[m]||d[m]||a;return t?r.createElement(g,o(o({ref:n},p),{},{components:t})):r.createElement(g,o({ref:n},p))}));function g(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var a=t.length,o=new Array(a);o[0]=m;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[u]="string"==typeof e?e:l,o[1]=i;for(var c=2;c<a;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},28450:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var r=t(87462),l=(t(67294),t(3905));const a={title:"\u7a97\u53e3\u51fd\u6570",language:"zh-CN"},o=void 0,i={unversionedId:"sql-reference/sql-functions/window-function",id:"version-0.15/sql-reference/sql-functions/window-function",title:"\u7a97\u53e3\u51fd\u6570",description:'\x3c!--  Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at',source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/sql-reference/sql-functions/window-function.md",sourceDirName:"sql-reference/sql-functions",slug:"/sql-reference/sql-functions/window-function",permalink:"/zh-CN/docs/0.15/sql-reference/sql-functions/window-function",draft:!1,tags:[],version:"0.15",frontMatter:{title:"\u7a97\u53e3\u51fd\u6570",language:"zh-CN"},sidebar:"docs",previous:{title:"murmur_hash3_32",permalink:"/zh-CN/docs/0.15/sql-reference/sql-functions/hash-functions/murmur_hash3_32"},next:{title:"CAST",permalink:"/zh-CN/docs/0.15/sql-reference/sql-functions/cast"}},s={},c=[{value:"\u7a97\u53e3\u51fd\u6570\u4ecb\u7ecd",id:"\u7a97\u53e3\u51fd\u6570\u4ecb\u7ecd",level:2},{value:"Function",id:"function",level:3},{value:"PARTITION BY\u4ece\u53e5",id:"partition-by\u4ece\u53e5",level:3},{value:"ORDER BY\u4ece\u53e5",id:"order-by\u4ece\u53e5",level:3},{value:"Window\u4ece\u53e5",id:"window\u4ece\u53e5",level:3},{value:"\u4e3e\u4f8b\uff1a",id:"\u4e3e\u4f8b",level:3},{value:"Function\u4f7f\u7528\u4e3e\u4f8b",id:"function\u4f7f\u7528\u4e3e\u4f8b",level:2},{value:"AVG()",id:"avg",level:3},{value:"COUNT()",id:"count",level:3},{value:"DENSE_RANK()",id:"dense_rank",level:3},{value:"FIRST_VALUE()",id:"first_value",level:3},{value:"LAG()",id:"lag",level:3},{value:"LAST_VALUE()",id:"last_value",level:3},{value:"LEAD()",id:"lead",level:3},{value:"MAX()",id:"max",level:3},{value:"MIN()",id:"min",level:3},{value:"RANK()",id:"rank",level:3},{value:"ROW_NUMBER()",id:"row_number",level:3},{value:"SUM()",id:"sum",level:3}],p={toc:c};function u(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"doris-\u7a97\u53e3\u51fd\u6570\u4f7f\u7528"},"Doris \u7a97\u53e3\u51fd\u6570\u4f7f\u7528"),(0,l.kt)("h2",{id:"\u7a97\u53e3\u51fd\u6570\u4ecb\u7ecd"},"\u7a97\u53e3\u51fd\u6570\u4ecb\u7ecd"),(0,l.kt)("p",null,"\u5206\u6790\u51fd\u6570\u662f\u4e00\u7c7b\u7279\u6b8a\u7684\u5185\u7f6e\u51fd\u6570\u3002\u548c\u805a\u5408\u51fd\u6570\u7c7b\u4f3c\uff0c\u5206\u6790\u51fd\u6570\u4e5f\u662f\u5bf9\u4e8e\u591a\u4e2a\u8f93\u5165\u884c\u505a\u8ba1\u7b97\u5f97\u5230\u4e00\u4e2a\u6570\u636e\u503c\u3002\u4e0d\u540c\u7684\u662f\uff0c\u5206\u6790\u51fd\u6570\u662f\u5728\u4e00\u4e2a\u7279\u5b9a\u7684\u7a97\u53e3\u5185\u5bf9\u8f93\u5165\u6570\u636e\u505a\u5904\u7406\uff0c\u800c\u4e0d\u662f\u6309\u7167 group by \u6765\u5206\u7ec4\u8ba1\u7b97\u3002\u6bcf\u4e2a\u7a97\u53e3\u5185\u7684\u6570\u636e\u53ef\u4ee5\u7528 over() \u4ece\u53e5\u8fdb\u884c\u6392\u5e8f\u548c\u5206\u7ec4\u3002\u5206\u6790\u51fd\u6570\u4f1a\u5bf9\u7ed3\u679c\u96c6\u7684\u6bcf\u4e00\u884c\u8ba1\u7b97\u51fa\u4e00\u4e2a\u5355\u72ec\u7684\u503c\uff0c\u800c\u4e0d\u662f\u6bcf\u4e2a group by \u5206\u7ec4\u8ba1\u7b97\u4e00\u4e2a\u503c\u3002\u8fd9\u79cd\u7075\u6d3b\u7684\u65b9\u5f0f\u5141\u8bb8\u7528\u6237\u5728 select \u4ece\u53e5\u4e2d\u589e\u52a0\u989d\u5916\u7684\u5217\uff0c\u7ed9\u7528\u6237\u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u673a\u4f1a\u6765\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u91cd\u65b0\u7ec4\u7ec7\u548c\u8fc7\u6ee4\u3002\u5206\u6790\u51fd\u6570\u53ea\u80fd\u51fa\u73b0\u5728 select \u5217\u8868\u548c\u6700\u5916\u5c42\u7684 order by \u4ece\u53e5\u4e2d\u3002\u5728\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u5206\u6790\u51fd\u6570\u4f1a\u5728\u6700\u540e\u751f\u6548\uff0c\u5c31\u662f\u8bf4\uff0c\u5728\u6267\u884c\u5b8c join\uff0cwhere \u548c group by \u7b49\u64cd\u4f5c\u4e4b\u540e\u518d\u6267\u884c\u3002\u5206\u6790\u51fd\u6570\u5728\u91d1\u878d\u548c\u79d1\u5b66\u8ba1\u7b97\u9886\u57df\u7ecf\u5e38\u88ab\u4f7f\u7528\u5230\uff0c\u7528\u6765\u5206\u6790\u8d8b\u52bf\u3001\u8ba1\u7b97\u79bb\u7fa4\u503c\u4ee5\u53ca\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u5206\u6876\u5206\u6790\u7b49\u3002"),(0,l.kt)("p",null,"\u5206\u6790\u51fd\u6570\u7684\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"function(args) OVER(partition_by_clause order_by_clause [window_clause])    \npartition_by_clause ::= PARTITION BY expr [, expr ...]    \norder_by_clause ::= ORDER BY expr [ASC | DESC] [, expr [ASC | DESC] ...]\n")),(0,l.kt)("h3",{id:"function"},"Function"),(0,l.kt)("p",null,"\u76ee\u524d\u652f\u6301\u7684 Function \u5305\u62ec AVG(), COUNT(), DENSE_RANK(), FIRST_VALUE(), LAG(), LAST_VALUE(), LEAD(), MAX(), MIN(), RANK(), ROW_NUMBER() \u548c SUM()\u3002"),(0,l.kt)("h3",{id:"partition-by\u4ece\u53e5"},"PARTITION BY\u4ece\u53e5"),(0,l.kt)("p",null,"Partition By \u4ece\u53e5\u548c Group By \u7c7b\u4f3c\u3002\u5b83\u628a\u8f93\u5165\u884c\u6309\u7167\u6307\u5b9a\u7684\u4e00\u5217\u6216\u591a\u5217\u5206\u7ec4\uff0c\u76f8\u540c\u503c\u7684\u884c\u4f1a\u88ab\u5206\u5230\u4e00\u7ec4\u3002"),(0,l.kt)("h3",{id:"order-by\u4ece\u53e5"},"ORDER BY\u4ece\u53e5"),(0,l.kt)("p",null,"Order By\u4ece\u53e5\u548c\u5916\u5c42\u7684Order By\u57fa\u672c\u4e00\u81f4\u3002\u5b83\u5b9a\u4e49\u4e86\u8f93\u5165\u884c\u7684\u6392\u5217\u987a\u5e8f\uff0c\u5982\u679c\u6307\u5b9a\u4e86 Partition By\uff0c\u5219 Order By \u5b9a\u4e49\u4e86\u6bcf\u4e2a Partition \u5206\u7ec4\u5185\u7684\u987a\u5e8f\u3002\u4e0e\u5916\u5c42 Order By \u7684\u552f\u4e00\u4e0d\u540c\u70b9\u662f\uff0cOVER \u4ece\u53e5\u4e2d\u7684 Order By n\uff08n\u662f\u6b63\u6574\u6570\uff09\u76f8\u5f53\u4e8e\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u800c\u5916\u5c42\u7684 Order By n\u8868\u793a\u6309\u7167\u7b2cn\u5217\u6392\u5e8f\u3002"),(0,l.kt)("p",null,"\u4e3e\u4f8b:"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u4f8b\u5b50\u5c55\u793a\u4e86\u5728select\u5217\u8868\u4e2d\u589e\u52a0\u4e00\u4e2aid\u5217\uff0c\u5b83\u7684\u503c\u662f1\uff0c2\uff0c3\u7b49\u7b49\uff0c\u987a\u5e8f\u6309\u7167events\u8868\u4e2d\u7684date_and_time\u5217\u6392\u5e8f\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT   \nrow_number() OVER (ORDER BY date_and_time) AS id,   \nc1, c2, c3, c4   \nFROM events;\n")),(0,l.kt)("h3",{id:"window\u4ece\u53e5"},"Window\u4ece\u53e5"),(0,l.kt)("p",null,"Window \u4ece\u53e5\u7528\u6765\u4e3a\u5206\u6790\u51fd\u6570\u6307\u5b9a\u4e00\u4e2a\u8fd0\u7b97\u8303\u56f4\uff0c\u4ee5\u5f53\u524d\u884c\u4e3a\u51c6\uff0c\u524d\u540e\u82e5\u5e72\u884c\u4f5c\u4e3a\u5206\u6790\u51fd\u6570\u8fd0\u7b97\u7684\u5bf9\u8c61\u3002Window \u4ece\u53e5\u652f\u6301\u7684\u65b9\u6cd5\u6709\uff1aAVG(), COUNT(), FIRST_VALUE(), LAST_VALUE() \u548c SUM()\u3002\u5bf9\u4e8e MAX() \u548c MIN(), window \u4ece\u53e5\u53ef\u4ee5\u6307\u5b9a\u5f00\u59cb\u8303\u56f4 UNBOUNDED PRECEDING"),(0,l.kt)("p",null,"\u8bed\u6cd5:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"ROWS BETWEEN [ { m | UNBOUNDED } PRECEDING | CURRENT ROW] [ AND [CURRENT ROW | { UNBOUNDED | n } FOLLOWING] ]\n")),(0,l.kt)("h3",{id:"\u4e3e\u4f8b"},"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u5047\u8bbe\u6211\u4eec\u6709\u5982\u4e0b\u7684\u80a1\u7968\u6570\u636e\uff0c\u80a1\u7968\u4ee3\u7801\u662f JDR\uff0cclosing price \u662f\u6bcf\u5929\u7684\u6536\u76d8\u4ef7\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"create table stock_ticker (stock_symbol string, closing_price decimal(8,2), closing_date timestamp);    \n...load some data...    \nselect * from stock_ticker order by stock_symbol, closing_date\n | stock_symbol | closing_price | closing_date        |\n |--------------|---------------|---------------------|\n | JDR          | 12.86         | 2014-10-02 00:00:00 |\n | JDR          | 12.89         | 2014-10-03 00:00:00 |\n | JDR          | 12.94         | 2014-10-04 00:00:00 |\n | JDR          | 12.55         | 2014-10-05 00:00:00 |\n | JDR          | 14.03         | 2014-10-06 00:00:00 |\n | JDR          | 14.75         | 2014-10-07 00:00:00 |\n | JDR          | 13.98         | 2014-10-08 00:00:00 |\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u67e5\u8be2\u4f7f\u7528\u5206\u6790\u51fd\u6570\u4ea7\u751f moving_average \u8fd9\u4e00\u5217\uff0c\u5b83\u7684\u503c\u662f3\u5929\u7684\u80a1\u7968\u5747\u4ef7\uff0c\u5373\u524d\u4e00\u5929\u3001\u5f53\u524d\u4ee5\u53ca\u540e\u4e00\u5929\u4e09\u5929\u7684\u5747\u4ef7\u3002\u7b2c\u4e00\u5929\u6ca1\u6709\u524d\u4e00\u5929\u7684\u503c\uff0c\u6700\u540e\u4e00\u5929\u6ca1\u6709\u540e\u4e00\u5929\u7684\u503c\uff0c\u6240\u4ee5\u8fd9\u4e24\u884c\u53ea\u8ba1\u7b97\u4e86\u4e24\u5929\u7684\u5747\u503c\u3002\u8fd9\u91cc Partition By \u6ca1\u6709\u8d77\u5230\u4f5c\u7528\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u6570\u636e\u90fd\u662f JDR \u7684\u6570\u636e\uff0c\u4f46\u5982\u679c\u8fd8\u6709\u5176\u4ed6\u80a1\u7968\u4fe1\u606f\uff0cPartition By \u4f1a\u4fdd\u8bc1\u5206\u6790\u51fd\u6570\u503c\u4f5c\u7528\u5728\u672c Partition \u4e4b\u5185\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select stock_symbol, closing_date, closing_price,    \navg(closing_price) over (partition by stock_symbol order by closing_date    \nrows between 1 preceding and 1 following) as moving_average    \nfrom stock_ticker;\n | stock_symbol | closing_date        | closing_price | moving_average |\n |--------------|---------------------|---------------|----------------|\n | JDR          | 2014-10-02 00:00:00 | 12.86         | 12.87          |\n | JDR          | 2014-10-03 00:00:00 | 12.89         | 12.89          |\n | JDR          | 2014-10-04 00:00:00 | 12.94         | 12.79          |\n | JDR          | 2014-10-05 00:00:00 | 12.55         | 13.17          |\n | JDR          | 2014-10-06 00:00:00 | 14.03         | 13.77          |\n | JDR          | 2014-10-07 00:00:00 | 14.75         | 14.25          |\n | JDR          | 2014-10-08 00:00:00 | 13.98         | 14.36          |\n")),(0,l.kt)("h2",{id:"function\u4f7f\u7528\u4e3e\u4f8b"},"Function\u4f7f\u7528\u4e3e\u4f8b"),(0,l.kt)("p",null,"\u672c\u8282\u4ecb\u7ecd Doris \u4e2d\u53ef\u4ee5\u7528\u4f5c\u5206\u6790\u51fd\u6570\u7684\u65b9\u6cd5\u3002"),(0,l.kt)("h3",{id:"avg"},"AVG()"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"AVG([DISTINCT | ALL] *expression*) [OVER (*analytic_clause*)]\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u8ba1\u7b97\u5f53\u524d\u884c\u548c\u5b83\u524d\u540e\u5404\u4e00\u884c\u6570\u636e\u7684x\u5e73\u5747\u503c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, property,    \navg(x) over    \n(   \npartition by property    \norder by x    \nrows between 1 preceding and 1 following    \n) as 'moving average'    \nfrom int_t where property in ('odd','even');\n | x  | property | moving average |\n |----|----------|----------------|\n | 2  | even     | 3              |\n | 4  | even     | 4              |\n | 6  | even     | 6              |\n | 8  | even     | 8              |\n | 10 | even     | 9              |\n | 1  | odd      | 2              |\n | 3  | odd      | 3              |\n | 5  | odd      | 5              |\n | 7  | odd      | 7              |\n | 9  | odd      | 8              |\n")),(0,l.kt)("h3",{id:"count"},"COUNT()"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"COUNT([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u8ba1\u7b97\u4ece\u5f53\u524d\u884c\u5230\u7b2c\u4e00\u884cx\u51fa\u73b0\u7684\u6b21\u6570\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, property,   \ncount(x) over   \n(   \npartition by property    \norder by x    \nrows between unbounded preceding and current row    \n) as 'cumulative total'    \nfrom int_t where property in ('odd','even');\n | x  | property | cumulative count |\n |----|----------|------------------|\n | 2  | even     | 1                |\n | 4  | even     | 2                |\n | 6  | even     | 3                |\n | 8  | even     | 4                |\n | 10 | even     | 5                |\n | 1  | odd      | 1                |\n | 3  | odd      | 2                |\n | 5  | odd      | 3                |\n | 7  | odd      | 4                |\n | 9  | odd      | 5                |\n")),(0,l.kt)("h3",{id:"dense_rank"},"DENSE_RANK()"),(0,l.kt)("p",null,"DENSE_RANK() \u51fd\u6570\u7528\u6765\u8868\u793a\u6392\u540d\uff0c\u4e0eRANK()\u4e0d\u540c\u7684\u662f\uff0cDENSE_RANK() \u4e0d\u4f1a\u51fa\u73b0\u7a7a\u7f3a\u6570\u5b57\u3002\u6bd4\u5982\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u4e24\u4e2a\u5e76\u5217\u76841\uff0cDENSE_RANK() \u7684\u7b2c\u4e09\u4e2a\u6570\u4ecd\u7136\u662f2\uff0c\u800cRANK()\u7684\u7b2c\u4e09\u4e2a\u6570\u662f3\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"DENSE_RANK() OVER(partition_by_clause order_by_clause)\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u4e0b\u4f8b\u5c55\u793a\u4e86\u6309\u7167 property \u5217\u5206\u7ec4\u5bf9x\u5217\u6392\u540d\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"}," select x, y, dense_rank() over(partition by x order by y) as rank from int_t;\n | x  | y    | rank     |\n |----|------|----------|\n | 1  | 1    | 1        |\n | 1  | 2    | 2        |\n | 1  | 2    | 2        |\n | 2  | 1    | 1        |\n | 2  | 2    | 2        |\n | 2  | 3    | 3        |\n | 3  | 1    | 1        |\n | 3  | 1    | 1        |\n | 3  | 2    | 2        |\n")),(0,l.kt)("h3",{id:"first_value"},"FIRST_VALUE()"),(0,l.kt)("p",null,"FIRST_VALUE() \u8fd4\u56de\u7a97\u53e3\u8303\u56f4\u5185\u7684\u7b2c\u4e00\u4e2a\u503c\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"FIRST_VALUE(expr) OVER(partition_by_clause order_by_clause [window_clause])\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u6211\u4eec\u6709\u5982\u4e0b\u6570\u636e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"}," select name, country, greeting from mail_merge;\n | name    | country | greeting     |\n |---------|---------|--------------|\n | Pete    | USA     | Hello        |\n | John    | USA     | Hi           |\n | Boris   | Germany | Guten tag    |\n | Michael | Germany | Guten morgen |\n | Bjorn   | Sweden  | Hej          |\n | Mats    | Sweden  | Tja          |\n")),(0,l.kt)("p",null,"\u4f7f\u7528 FIRST_VALUE()\uff0c\u6839\u636e country \u5206\u7ec4\uff0c\u8fd4\u56de\u6bcf\u4e2a\u5206\u7ec4\u4e2d\u7b2c\u4e00\u4e2a greeting \u7684\u503c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select country, name,    \nfirst_value(greeting)    \nover (partition by country order by name, greeting) as greeting from mail_merge;\n| country | name    | greeting  |\n|---------|---------|-----------|\n| Germany | Boris   | Guten tag |\n| Germany | Michael | Guten tag |\n| Sweden  | Bjorn   | Hej       |\n| Sweden  | Mats    | Hej       |\n| USA     | John    | Hi        |\n| USA     | Pete    | Hi        |\n")),(0,l.kt)("h3",{id:"lag"},"LAG()"),(0,l.kt)("p",null,"LAG() \u65b9\u6cd5\u7528\u6765\u8ba1\u7b97\u5f53\u524d\u884c\u5411\u524d\u6570\u82e5\u5e72\u884c\u7684\u503c\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"LAG (expr, offset, default) OVER (partition_by_clause order_by_clause)\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u8ba1\u7b97\u524d\u4e00\u5929\u7684\u6536\u76d8\u4ef7"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},'select stock_symbol, closing_date, closing_price,    \nlag(closing_price,1, 0) over (partition by stock_symbol order by closing_date) as "yesterday closing"   \nfrom stock_ticker   \norder by closing_date;\n| stock_symbol | closing_date        | closing_price | yesterday closing |\n|--------------|---------------------|---------------|-------------------|\n| JDR          | 2014-09-13 00:00:00 | 12.86         | 0                 |\n| JDR          | 2014-09-14 00:00:00 | 12.89         | 12.86             |\n| JDR          | 2014-09-15 00:00:00 | 12.94         | 12.89             |\n| JDR          | 2014-09-16 00:00:00 | 12.55         | 12.94             |\n| JDR          | 2014-09-17 00:00:00 | 14.03         | 12.55             |\n| JDR          | 2014-09-18 00:00:00 | 14.75         | 14.03             |\n| JDR          | 2014-09-19 00:00:00 | 13.98         | 14.75             |\n')),(0,l.kt)("h3",{id:"last_value"},"LAST_VALUE()"),(0,l.kt)("p",null,"LAST_VALUE() \u8fd4\u56de\u7a97\u53e3\u8303\u56f4\u5185\u7684\u6700\u540e\u4e00\u4e2a\u503c\u3002\u4e0e FIRST_VALUE() \u76f8\u53cd\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"LAST_VALUE(expr) OVER(partition_by_clause order_by_clause [window_clause])\n")),(0,l.kt)("p",null,"\u4f7f\u7528FIRST_VALUE()\u4e3e\u4f8b\u4e2d\u7684\u6570\u636e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select country, name,    \nlast_value(greeting)   \nover (partition by country order by name, greeting) as greeting   \nfrom mail_merge;\n| country | name    | greeting     |\n|---------|---------|--------------|\n| Germany | Boris   | Guten morgen |\n| Germany | Michael | Guten morgen |\n| Sweden  | Bjorn   | Tja          |\n| Sweden  | Mats    | Tja          |\n| USA     | John    | Hello        |\n| USA     | Pete    | Hello        |\n")),(0,l.kt)("h3",{id:"lead"},"LEAD()"),(0,l.kt)("p",null,"LEAD() \u65b9\u6cd5\u7528\u6765\u8ba1\u7b97\u5f53\u524d\u884c\u5411\u540e\u6570\u82e5\u5e72\u884c\u7684\u503c\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"LEAD (expr, offset, default]) OVER (partition_by_clause order_by_clause)\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u8ba1\u7b97\u7b2c\u4e8c\u5929\u7684\u6536\u76d8\u4ef7\u5bf9\u6bd4\u5f53\u5929\u6536\u76d8\u4ef7\u7684\u8d70\u52bf\uff0c\u5373\u7b2c\u4e8c\u5929\u6536\u76d8\u4ef7\u6bd4\u5f53\u5929\u9ad8\u8fd8\u662f\u4f4e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},'select stock_symbol, closing_date, closing_price,    \ncase   \n(lead(closing_price,1, 0)   \nover (partition by stock_symbol order by closing_date)-closing_price) > 0   \nwhen true then "higher"   \nwhen false then "flat or lower"    \nend as "trending"   \nfrom stock_ticker    \norder by closing_date;\n| stock_symbol | closing_date        | closing_price | trending      |\n|--------------|---------------------|---------------|---------------|\n| JDR          | 2014-09-13 00:00:00 | 12.86         | higher        |\n| JDR          | 2014-09-14 00:00:00 | 12.89         | higher        |\n| JDR          | 2014-09-15 00:00:00 | 12.94         | flat or lower |\n| JDR          | 2014-09-16 00:00:00 | 12.55         | higher        |\n| JDR          | 2014-09-17 00:00:00 | 14.03         | higher        |\n| JDR          | 2014-09-18 00:00:00 | 14.75         | flat or lower |\n| JDR          | 2014-09-19 00:00:00 | 13.98         | flat or lower |\n')),(0,l.kt)("h3",{id:"max"},"MAX()"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"MAX([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u8ba1\u7b97\u4ece\u7b2c\u4e00\u884c\u5230\u5f53\u524d\u884c\u4e4b\u540e\u4e00\u884c\u7684\u6700\u5927\u503c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, property,   \nmax(x) over    \n(   \norder by property, x    \nrows between unbounded preceding and 1 following    \n) as 'local maximum'    \nfrom int_t where property in ('prime','square');\n| x | property | local maximum |\n|---|----------|---------------|\n| 2 | prime    | 3             |\n| 3 | prime    | 5             |\n| 5 | prime    | 7             |\n| 7 | prime    | 7             |\n| 1 | square   | 7             |\n| 4 | square   | 9             |\n| 9 | square   | 9             |\n")),(0,l.kt)("h3",{id:"min"},"MIN()"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"MIN([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u8ba1\u7b97\u4ece\u7b2c\u4e00\u884c\u5230\u5f53\u524d\u884c\u4e4b\u540e\u4e00\u884c\u7684\u6700\u5c0f\u503c"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, property,   \nmin(x) over    \n(    \norder by property, x desc    \nrows between unbounded preceding and 1 following   \n) as 'local minimum'   \nfrom int_t where property in ('prime','square');\n| x | property | local minimum |\n|---|----------|---------------|\n| 7 | prime    | 5             |\n| 5 | prime    | 3             |\n| 3 | prime    | 2             |\n| 2 | prime    | 2             |\n| 9 | square   | 2             |\n| 4 | square   | 1             |\n| 1 | square   | 1             |\n")),(0,l.kt)("h3",{id:"rank"},"RANK()"),(0,l.kt)("p",null,"RANK() \u51fd\u6570\u7528\u6765\u8868\u793a\u6392\u540d\uff0c\u4e0e DENSE_RANK() \u4e0d\u540c\u7684\u662f\uff0cRANK() \u4f1a\u51fa\u73b0\u7a7a\u7f3a\u6570\u5b57\u3002\u6bd4\u5982\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u4e24\u4e2a\u5e76\u5217\u76841\uff0c RANK() \u7684\u7b2c\u4e09\u4e2a\u6570\u5c31\u662f3\uff0c\u800c\u4e0d\u662f2\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"RANK() OVER(partition_by_clause order_by_clause)\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u6839\u636e x \u8fdb\u884c\u6392\u540d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, y, rank() over(partition by x order by y) as rank from int_t;\n| x  | y    | rank     |\n|----|------|----------|\n| 1  | 1    | 1        |\n| 1  | 2    | 2        |\n| 1  | 2    | 2        |\n| 2  | 1    | 1        |\n| 2  | 2    | 2        |\n| 2  | 3    | 3        |\n| 3  | 1    | 1        |\n| 3  | 1    | 1        |\n| 3  | 2    | 3        |\n")),(0,l.kt)("h3",{id:"row_number"},"ROW_NUMBER()"),(0,l.kt)("p",null,"\u4e3a\u6bcf\u4e2a Partition \u7684\u6bcf\u4e00\u884c\u8fd4\u56de\u4e00\u4e2a\u4ece1\u5f00\u59cb\u8fde\u7eed\u9012\u589e\u7684\u6574\u6570\u3002\u4e0e RANK() \u548c DENSE_RANK() \u4e0d\u540c\u7684\u662f\uff0cROW_NUMBER() \u8fd4\u56de\u7684\u503c\u4e0d\u4f1a\u91cd\u590d\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u7a7a\u7f3a\uff0c\u662f\u8fde\u7eed\u9012\u589e\u7684\u3002"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"ROW_NUMBER() OVER(partition_by_clause order_by_clause)\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, y, row_number() over(partition by x order by y) as rank from int_t;\n| x | y    | rank     |\n|---|------|----------|\n| 1 | 1    | 1        |\n| 1 | 2    | 2        |\n| 1 | 2    | 3        |\n| 2 | 1    | 1        |\n| 2 | 2    | 2        |\n| 2 | 3    | 3        |\n| 3 | 1    | 1        |\n| 3 | 1    | 2        |\n| 3 | 2    | 3        |\n")),(0,l.kt)("h3",{id:"sum"},"SUM()"),(0,l.kt)("p",null,"\u8bed\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"SUM([DISTINCT | ALL] expression) [OVER (analytic_clause)]\n")),(0,l.kt)("p",null,"\u4e3e\u4f8b\uff1a"),(0,l.kt)("p",null,"\u6309\u7167 property \u8fdb\u884c\u5206\u7ec4\uff0c\u5728\u7ec4\u5185\u8ba1\u7b97\u5f53\u524d\u884c\u4ee5\u53ca\u524d\u540e\u5404\u4e00\u884c\u7684x\u5217\u7684\u548c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select x, property,   \nsum(x) over    \n(   \npartition by property   \norder by x   \nrows between 1 preceding and 1 following    \n) as 'moving total'    \nfrom int_t where property in ('odd','even');\n| x  | property | moving total |\n|----|----------|--------------|\n| 2  | even     | 6            |\n| 4  | even     | 12           |\n| 6  | even     | 18           |\n| 8  | even     | 24           |\n| 10 | even     | 18           |\n| 1  | odd      | 4            |\n| 3  | odd      | 9            |\n| 5  | odd      | 15           |\n| 7  | odd      | 21           |\n| 9  | odd      | 16           |\n")))}u.isMDXComponent=!0}}]);