"use strict";(self.webpackChunkselectdb_portal=self.webpackChunkselectdb_portal||[]).push([[82602],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>g});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",b={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=s(a),m=r,g=p["".concat(c,".").concat(m)]||p[m]||b[m]||i;return a?n.createElement(g,l(l({ref:t},d),{},{components:a})):n.createElement(g,l({ref:t},d))}));function g(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o[p]="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=a[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},93850:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>s});var n=a(87462),r=(a(67294),a(3905));const i={title:"Doris On Iceberg",language:"en"},l=void 0,o={unversionedId:"ecosystem/external-table/iceberg-of-doris",id:"ecosystem/external-table/iceberg-of-doris",title:"Doris On Iceberg",description:"\x3c!--",source:"@site/docs/ecosystem/external-table/iceberg-of-doris.md",sourceDirName:"ecosystem/external-table",slug:"/ecosystem/external-table/iceberg-of-doris",permalink:"/docs/ecosystem/external-table/iceberg-of-doris",draft:!1,tags:[],version:"current",frontMatter:{title:"Doris On Iceberg",language:"en"},sidebar:"docs",previous:{title:"Doris On Hive",permalink:"/docs/ecosystem/external-table/hive-of-doris"},next:{title:"Audit log plugin",permalink:"/docs/ecosystem/audit-plugin"}},c={},s=[{value:"Glossary",id:"glossary",level:2},{value:"Noun in Doris",id:"noun-in-doris",level:3},{value:"How to use",id:"how-to-use",level:2},{value:"Create Iceberg External Table",id:"create-iceberg-external-table",level:3},{value:"Parameter Description",id:"parameter-description",level:4},{value:"Show table structure",id:"show-table-structure",level:3},{value:"Synchronized mounts",id:"synchronized-mounts",level:3},{value:"Data Type Matching",id:"data-type-matching",level:2},{value:"Query Usage",id:"query-usage",level:3},{value:"Related system configurations",id:"related-system-configurations",level:2},{value:"FE Configuration",id:"fe-configuration",level:3}],d={toc:s};function p(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"iceberg-external-table-of-doris"},"Iceberg External Table of Doris"),(0,r.kt)("p",null,"Iceberg External Table of Doris provides Doris with the ability to access Iceberg external tables directly, eliminating the need for cumbersome data import and leveraging Doris' own OLAP capabilities to solve Iceberg table data analysis problems."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"support Iceberg data sources to access Doris"),(0,r.kt)("li",{parentName:"ol"},"Support joint query between Doris and Iceberg data source tables to perform more complex analysis operations")),(0,r.kt)("p",null,"This document introduces how to use this feature and the considerations."),(0,r.kt)("h2",{id:"glossary"},"Glossary"),(0,r.kt)("h3",{id:"noun-in-doris"},"Noun in Doris"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"FE: Frontend, the front-end node of Doris, responsible for metadata management and request access"),(0,r.kt)("li",{parentName:"ul"},"BE: Backend, the backend node of Doris, responsible for query execution and data storage")),(0,r.kt)("h2",{id:"how-to-use"},"How to use"),(0,r.kt)("h3",{id:"create-iceberg-external-table"},"Create Iceberg External Table"),(0,r.kt)("p",null,"Iceberg tables can be created in Doris in two ways. You do not need to declare the column definitions of the table when creating an external table, Doris can automatically convert them based on the column definitions of the table in Iceberg."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a separate external table to mount the Iceberg table.",(0,r.kt)("br",{parentName:"p"}),"\n","The syntax can be viewed in ",(0,r.kt)("a",{parentName:"p",href:"/docs/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-TABLE"},"CREATE TABLE"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'-- Syntax\nCREATE [EXTERNAL] TABLE table_name \nENGINE = ICEBERG\n[COMMENT "comment"]\nPROPERTIES (\n"iceberg.database" = "iceberg_db_name",\n"iceberg.table" = "icberg_table_name",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG"\n);\n')))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'-- Example 1: Mount iceberg_table under iceberg_db in Iceberg \nCREATE TABLE `t_iceberg` \nENGINE = ICEBERG\nPROPERTIES (\n"iceberg.database" = "iceberg_db",\n"iceberg.table" = "iceberg_table",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG"\n);\n\n-- Example 2: Mount iceberg_table under iceberg_db in Iceberg, with HDFS HA enabled.\nCREATE TABLE `t_iceberg`\nENGINE = ICEBERG\nPROPERTIES (\n"iceberg.database" = "iceberg_db",\n"iceberg.table" = "iceberg_table"\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG",\n"dfs.nameservices"="HDFS8000463",\n"dfs.ha.namenodes.HDFS8000463"="nn2,nn1",\n"dfs.namenode.rpc-address.HDFS8000463.nn2"="172.21.16.5:4007",\n"dfs.namenode.rpc-address.HDFS8000463.nn1"="172.21.16.26:4007",\n"dfs.client.failover.proxy.provider.HDFS8000463"="org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider"\n);\n```\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create an Iceberg database to mount the corresponding Iceberg database on the remote side, and mount all the tables under the database.",(0,r.kt)("br",{parentName:"p"}),"\n","You can check the syntax with ",(0,r.kt)("a",{parentName:"p",href:"/docs/sql-manual/sql-reference/Data-Definition-Statements/Create/CREATE-DATABASE"},"CREATE DATABASE"),"."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'-- Syntax\nCREATE DATABASE db_name \n[COMMENT "comment"]\nPROPERTIES (\n"iceberg.database" = "iceberg_db_name",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG"\n);\n\n-- Example: mount the iceberg_db in Iceberg and mount all tables under that db\nCREATE DATABASE `iceberg_test_db`\nPROPERTIES (\n"iceberg.database" = "iceberg_db",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG"\n);\n')),(0,r.kt)("p",{parentName:"li"}," The progress of the table build in ",(0,r.kt)("inlineCode",{parentName:"p"},"iceberg_test_db")," can be viewed by ",(0,r.kt)("inlineCode",{parentName:"p"},"HELP SHOW TABLE CREATION"),"."))),(0,r.kt)("p",null,"You can also create an Iceberg table by explicitly specifying the column definitions according to your needs."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create an Iceberg table"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'-- Syntax\nCREATE [EXTERNAL] TABLE table_name (\n    col_name col_type [NULL | NOT NULL] [COMMENT "comment"]\n) ENGINE = ICEBERG\n[COMMENT "comment"] )\nPROPERTIES (\n"iceberg.database" = "iceberg_db_name",\n"iceberg.table" = "icberg_table_name",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG"\n);\n\n-- Example 1: Mount iceberg_table under iceberg_db in Iceberg \nCREATE TABLE `t_iceberg` (\n    `id` int NOT NULL COMMENT "id number",\n    `name` varchar(10) NOT NULL COMMENT "user name"\n) ENGINE = ICEBERG\nPROPERTIES (\n"iceberg.database" = "iceberg_db",\n"iceberg.table" = "iceberg_table",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG"\n);\n\n-- Example 2: Mount iceberg_table under iceberg_db in Iceberg, with HDFS HA enabled.\nCREATE TABLE `t_iceberg` (\n    `id` int NOT NULL COMMENT "id number",\n    `name` varchar(10) NOT NULL COMMENT "user name"\n) ENGINE = ICEBERG\nPROPERTIES (\n"iceberg.database" = "iceberg_db",\n"iceberg.table" = "iceberg_table",\n"iceberg.hive.metastore.uris" = "thrift://192.168.0.1:9083",\n"iceberg.catalog.type" = "HIVE_CATALOG",\n"dfs.nameservices"="HDFS8000463",\n"dfs.ha.namenodes.HDFS8000463"="nn2,nn1",\n"dfs.namenode.rpc-address.HDFS8000463.nn2"="172.21.16.5:4007",\n"dfs.namenode.rpc-address.HDFS8000463.nn1"="172.21.16.26:4007",\n"dfs.client.failover.proxy.provider.HDFS8000463"="org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider"\n);\n\n')))),(0,r.kt)("h4",{id:"parameter-description"},"Parameter Description"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"External Table Columns",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Column names should correspond to the Iceberg table"),(0,r.kt)("li",{parentName:"ul"},"The order of the columns needs to be consistent with the Iceberg table"))),(0,r.kt)("li",{parentName:"ul"},"ENGINE needs to be specified as ICEBERG"),(0,r.kt)("li",{parentName:"ul"},"PROPERTIES property.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"iceberg.hive.metastore.uris"),": Hive Metastore service address"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"iceberg.database"),": the name of the database to which Iceberg is mounted"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"iceberg.table"),": the name of the table to which Iceberg is mounted, not required when mounting Iceberg database."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"iceberg.catalog.type"),": the catalog method used in Iceberg, the default is ",(0,r.kt)("inlineCode",{parentName:"li"},"HIVE_CATALOG"),", currently only this method is supported, more Iceberg catalog access methods will be supported in the future.")))),(0,r.kt)("h3",{id:"show-table-structure"},"Show table structure"),(0,r.kt)("p",null,"Show table structure can be viewed by ",(0,r.kt)("a",{parentName:"p",href:"/docs/sql-manual/sql-reference/Show-Statements/SHOW-CREATE-TABLE"},"SHOW CREATE TABLE"),"."),(0,r.kt)("h3",{id:"synchronized-mounts"},"Synchronized mounts"),(0,r.kt)("p",null,"When the Iceberg table Schema changes, you can manually synchronize it with the ",(0,r.kt)("inlineCode",{parentName:"p"},"REFRESH")," command, which will remove and rebuild the Iceberg external table in Doris, as seen in the ",(0,r.kt)("inlineCode",{parentName:"p"},"HELP REFRESH")," help."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- Synchronize the Iceberg table\nREFRESH TABLE t_iceberg;\n\n-- Synchronize the Iceberg database\nREFRESH DATABASE iceberg_test_db;\n")),(0,r.kt)("h2",{id:"data-type-matching"},"Data Type Matching"),(0,r.kt)("p",null,"The supported Iceberg column types correspond to Doris in the following table."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},"Iceberg"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Doris"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"BOOLEAN"),(0,r.kt)("td",{parentName:"tr",align:"center"},"BOOLEAN"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"INTEGER"),(0,r.kt)("td",{parentName:"tr",align:"center"},"INT"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"LONG"),(0,r.kt)("td",{parentName:"tr",align:"center"},"BIGINT"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"FLOAT"),(0,r.kt)("td",{parentName:"tr",align:"center"},"FLOAT"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"DOUBLE"),(0,r.kt)("td",{parentName:"tr",align:"center"},"DOUBLE"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"DATE"),(0,r.kt)("td",{parentName:"tr",align:"center"},"DATE"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"TIMESTAMP"),(0,r.kt)("td",{parentName:"tr",align:"center"},"DATETIME"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Timestamp to Datetime with loss of precision")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"STRING"),(0,r.kt)("td",{parentName:"tr",align:"center"},"STRING"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"UUID"),(0,r.kt)("td",{parentName:"tr",align:"center"},"VARCHAR"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Use VARCHAR instead")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"DECIMAL"),(0,r.kt)("td",{parentName:"tr",align:"center"},"DECIMAL"),(0,r.kt)("td",{parentName:"tr",align:"center"})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"TIME"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"not supported")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"FIXED"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"not supported")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"BINARY"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"not supported")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"STRUCT"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"not supported")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"LIST"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"not supported")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"MAP"),(0,r.kt)("td",{parentName:"tr",align:"center"},"-"),(0,r.kt)("td",{parentName:"tr",align:"center"},"not supported")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note:")," "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Iceberg table Schema changes ",(0,r.kt)("strong",{parentName:"li"},"are not automatically synchronized")," and require synchronization of Iceberg external tables or databases in Doris via the ",(0,r.kt)("inlineCode",{parentName:"li"},"REFRESH")," command."),(0,r.kt)("li",{parentName:"ul"},"The current default supported version of Iceberg is 0.12.0,0.13.2 and has not been tested in other versions. More versions will be supported in the future.")),(0,r.kt)("h3",{id:"query-usage"},"Query Usage"),(0,r.kt)("p",null,"Once you have finished building the Iceberg external table in Doris, it is no different from a normal Doris OLAP table except that you cannot use the data models in Doris (rollup, preaggregation, materialized views, etc.)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"select * from t_iceberg where k1 > 1000 and k3 = 'term' or k4 like '%doris';\n")),(0,r.kt)("h2",{id:"related-system-configurations"},"Related system configurations"),(0,r.kt)("h3",{id:"fe-configuration"},"FE Configuration"),(0,r.kt)("p",null,"The following configurations are at the Iceberg external table system level and can be configured by modifying ",(0,r.kt)("inlineCode",{parentName:"p"},"fe.conf")," or by ",(0,r.kt)("inlineCode",{parentName:"p"},"ADMIN SET CONFIG"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"iceberg_table_creation_strict_mode"),"  "),(0,r.kt)("p",{parentName:"li"},"Iceberg tables are created with strict mode enabled by default.",(0,r.kt)("br",{parentName:"p"}),"\n","strict mode means that the column types of the Iceberg table are strictly filtered, and if there are data types that Doris does not currently support, the creation of the table will fail.  ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"iceberg_table_creation_interval_second"),"  "),(0,r.kt)("p",{parentName:"li"},"The background task execution interval for automatic creation of Iceberg tables, default is 10s.  ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"max_iceberg_table_creation_record_size")),(0,r.kt)("p",{parentName:"li"},"The maximum value reserved for Iceberg table creation records, default is 2000. Only for creating Iceberg database records."))))}p.isMDXComponent=!0}}]);