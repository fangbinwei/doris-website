"use strict";(self.webpackChunkselectdb_portal=self.webpackChunkselectdb_portal||[]).push([[11622],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=s(n),u=a,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||o;return n?r.createElement(h,c(c({ref:t},p),{},{components:n})):r.createElement(h,c({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:a,c[1]=i;for(var s=2;s<o;s++)c[s]=n[s];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},82772:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>s});var r=n(87462),a=(n(67294),n(3905));const o={title:"CHECK ALL TABLET SEGMENT LOST",language:"en"},c=void 0,i={unversionedId:"admin-manual/http-actions/check-tablet-segment-action",id:"version-dev/admin-manual/http-actions/check-tablet-segment-action",title:"CHECK ALL TABLET SEGMENT LOST",description:"\x3c!--",source:"@site/versioned_docs/version-dev/admin-manual/http-actions/check-tablet-segment-action.md",sourceDirName:"admin-manual/http-actions",slug:"/admin-manual/http-actions/check-tablet-segment-action",permalink:"/docs/dev/admin-manual/http-actions/check-tablet-segment-action",draft:!1,editUrl:"https://github.com/apache/doris/edit/master/docs/en/docs/admin-manual/http-actions/check-tablet-segment-action.md",tags:[],version:"dev",frontMatter:{title:"CHECK ALL TABLET SEGMENT LOST",language:"en"},sidebar:"docs",previous:{title:"CHECK/RESET Stub Cache",permalink:"/docs/dev/admin-manual/http-actions/check-reset-rpc-cache"},next:{title:"Install Error",permalink:"/docs/dev/faq/install-faq"}},l={},s=[],p={toc:s};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"check-all-tablet-segment-lost"},"CHECK ALL TABLET SEGMENT LOST"),(0,a.kt)("p",null,"There may be some exceptions that cause segment to be lost on BE node. However, the metadata shows that the tablet is normal. This abnormal replica is not detected by FE and cannot be automatically repaired.\nWhen query comes, exception information is thrown that ",(0,a.kt)("inlineCode",{parentName:"p"},"failed to initialize storage reader"),". The function of this interface is to check all tablets on the current BE node that have lost segment."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"curl -X POST http://be_host:webserver_port/api/check_tablet_segment_lost?repair=xxx\n")),(0,a.kt)("p",null,"When parameter ",(0,a.kt)("inlineCode",{parentName:"p"},"repair")," is set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),", tablets with lost segment will be set to ",(0,a.kt)("inlineCode",{parentName:"p"},"SHUTDOWN")," status and treated as bad replica, which can be detected and repaired by FE. Otherwise, all tablets with missing segment are returned and nothing is done."),(0,a.kt)("p",null,"The return is all tablets on the current BE node that have lost segment:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n    status: "Success",\n    msg: "Succeed to check all tablet segment",\n    num: 3,\n    bad_tablets: [\n        11190,\n        11210,\n        11216\n    ],\n    set_bad: true,\n    host: "172.3.0.101"\n}\n')))}d.isMDXComponent=!0}}]);